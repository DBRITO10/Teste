
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minhas Despesas</title>
<style>
  :root{
    --bg:#0f1115;
    --card:#181b22;
    --muted:#a6adbb;
    --text:#e8edf7;
    --accent:#2b8cff;
    --success:#22c55e;
    --danger:#ef4444;
    --shadow:0 10px 30px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
  header{
    padding:16px 20px 16px;
    position:sticky;top:0;z-index:5;
    background:linear-gradient(180deg,rgba(15,17,21,0.95),rgba(15,17,21,0.75) 60%,rgba(15,17,21,0));
    backdrop-filter: blur(6px);
    display:flex;flex-direction:column;gap:6px;
  }
  header h1{
    margin:0 0 12px;
    font-size:1.6rem;
    font-weight:700;
    display:flex;justify-content:space-between;align-items:center;
  }
  .header-buttons{display:flex;gap:10px;align-items:center}
  .totals{
    display:flex;gap:28px;align-items:flex-start;justify-content:flex-start;
    padding:6px 0 12px;border-bottom:1px solid rgba(255,255,255,.06);
  }
  .metric small{display:block;color:var(--muted);font-weight:600;opacity:.9}
  .metric strong{display:block;font-size:1.35rem;margin-top:4px}
  .month{
    display:flex;align-items:center;justify-content:space-between;
    margin:12px 0 4px;gap:12px
  }
  .month .pill{
    background:var(--card);border-radius:16px;padding:10px 14px;flex:1;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:var(--shadow)
  }
  .icon-btn{background:transparent;border:none;color:var(--text);font-size:1.2rem;padding:8px 10px;border-radius:10px;cursor:pointer}

  main{max-width:720px;margin:8px auto 80px;padding:0 14px}
  ul.list{list-style:none;margin:0;padding:0}
  li.item{display:flex;align-items:center;justify-content:space-between;gap:12px;background:var(--card);border-radius:14px;padding:12px 14px;margin:10px 0;box-shadow:var(--shadow)}
  .left{display:flex;align-items:center;gap:12px}
  .avatar{width:40px;height:40px;border-radius:20px;display:grid;place-items:center;font-size:18px}
  .title{font-weight:700}
  .sub{color:var(--muted);font-size:.9rem;margin-top:2px}
  .right{text-align:right}
  .value{font-weight:800}
  .date{color:var(--muted);font-size:.9rem;margin-top:4px}
  .status-dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-left:8px}

  /* FAB */
  .fab{position:fixed;right:20px;bottom:24px;width:58px;height:58px;border-radius:50%;border:none;background:var(--accent);color:white;font-size:2rem;line-height:0;display:grid;place-items:center;box-shadow:var(--shadow);cursor:pointer;z-index:6}

  /* Modal (cadastro/edi√ß√£o e detalhes) */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:flex-end;justify-content:center;z-index:10}
  .modal.show{display:flex}
  .sheet{width:100%;max-width:720px;background:var(--card);border-radius:18px 18px 0 0;padding:16px 16px 24px;box-shadow:var(--shadow)}
  .sheet h2{margin:0 0 10px}
  label{display:block;font-size:.95rem;margin:10px 0 6px;color:var(--muted)}
  input,select{width:100%;padding:12px 12px;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:#10131a;color:var(--text)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .actions{display:flex;gap:10px;margin-top:16px}
  .btn{flex:1;padding:12px 14px;border-radius:12px;border:none;cursor:pointer;font-weight:700}
  .btn.primary{background:var(--accent);color:white}
  .btn.ghost{background:#0f131a;border:1px solid rgba(255,255,255,.08);color:var(--text)}
  .btn.danger{background:#3a0e12;color:#ffb4b4;border:1px solid #5c1b22}

  /* Detail sheet */
  .detail .line{display:flex;align-items:center;gap:12px;margin:14px 0}
  .tag{width:28px;height:28px;border-radius:14px;display:grid;place-items:center}
  .muted{color:var(--muted)}
  .toolbar{display:flex;gap:10px;margin-left:auto}
  .toolbar .icon-btn{opacity:.8}

  /* Category colors */
  .c-others{background:#1e9db0}
  .c-bills{background:#c6a44d}
  .c-edu{background:#4c63d6}
  .c-ent{background:#a34747}
  .c-health{background:#7f3fb6}
  .c-clothes{background:#2b4cbf}
  .c-food{background:#f97316}
  .c-trans{background:#10b981}
  .c-home{background:#8b5cf6}
  .c-card{background:#eab308}

  footer.totbar{position:fixed;left:0;right:0;bottom:0;height:12px;background:linear-gradient(180deg,rgba(15,17,21,0),rgba(15,17,21,0.85) 30%,rgba(15,17,21,1));}
  .filter-select{background:var(--card);color:var(--text);border:none;border-radius:12px;padding:6px 10px;font-size:.9rem;cursor:pointer}
</style>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2b8cff">

<style>
body.light-theme {
  background-color: #ffffff !important;
  color: #000000 !important;
}
body.light-theme * {
  color: #000000 !important;
}
</style>


<style>
body.light-theme {
  background-color: #ffffff !important;
  color: #000000 !important;
  --accent: #000000 !important;
  --success: #000000 !important;
  --warning: #000000 !important;
  --danger: #000000 !important;
  --info: #000000 !important;
}
</style>


<style>
/* ===== TEMA CLARO REFORMULADO ===== */
body.light-theme {
  background-color: #ffffff !important;
  color: #1a1a1a !important;

  --accent: #007bff !important; /* Azul vivo para destaques */
  --success: #28a745 !important; /* Verde moderado para sucesso */
  --warning: #ffc107 !important; /* Amarelo para avisos */
  --danger: #dc3545 !important;  /* Vermelho para erros */
  --info: #17a2b8 !important;    /* Azul claro para informa√ß√µes */

  --card: #ffffff !important;    /* Fundo branco para cart√µes */
  --muted: #6c757d !important;   /* Cinza para textos secund√°rios */
}

body.light-theme .card {
  background-color: var(--card) !important;
  color: #1a1a1a !important;
  border: 1px solid #e0e0e0 !important;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05) !important;
}

body.light-theme h1,
body.light-theme h2,
body.light-theme h3,
body.light-theme h4,
body.light-theme h5,
body.light-theme h6 {
  color: #000000 !important;
}

body.light-theme a {
  color: var(--accent) !important;
}

body.light-theme button,
body.light-theme .btn {
  color: #ffffff !important;
  border: none !important;
}

body.light-theme .btn-primary { background-color: var(--accent) !important; }
body.light-theme .btn-success { background-color: var(--success) !important; }
body.light-theme .btn-warning { background-color: var(--warning) !important; color: #000000 !important; }
body.light-theme .btn-danger { background-color: var(--danger) !important; }
body.light-theme .btn-info { background-color: var(--info) !important; }

body.light-theme input,
body.light-theme select,
body.light-theme textarea {
  background-color: #ffffff !important;
  color: #000000 !important;
  border: 1px solid #ccc !important;
}

body.light-theme table {
  background-color: #ffffff !important;
  color: #000000 !important;
  border-collapse: collapse !important;
}

body.light-theme th,
body.light-theme td {
  border: 1px solid #e0e0e0 !important;
}

body.light-theme header,
body.light-theme nav {
  background-color: #f8f9fa !important;
  color: #000000 !important;
}

body.light-theme footer {
  background-color: #f1f1f1 !important;
  color: #000000 !important;
}
</style>


<style>
/* Ajustes adicionais para o tema claro */
body.light-theme .modal-header {
  background-color: #ffffff !important;
  color: #000000 !important;
  border-bottom: 1px solid #ddd !important;
}
body.light-theme .modal-header .close,
body.light-theme .modal-header button {
  color: #000000 !important;
}
body.light-theme .btn-edit,
body.light-theme .edit-button,
body.light-theme button.edit {
  color: #000000 !important;
}
</style>


<style>
/* Ajustes de cores no tema claro para modais */
body.light-theme .modal-header {
  background-color: #ffffff !important;
  color: #000000 !important;
  border-bottom: 1px solid #ddd !important;
}
body.light-theme .modal-header .close,
body.light-theme .modal-header button {
  color: #000000 !important;
}
body.light-theme .btn-edit,
body.light-theme .edit-button,
body.light-theme button.edit,
body.light-theme [title="Editar"] {
  color: #000000 !important;
}
</style>


<style>
/* For√ßar o X do modal a ser preto no tema claro */
body.light-theme .modal-header .close,
body.light-theme .modal-header .close svg,
body.light-theme .modal-header .close path,
body.light-theme .modal-header button.close,
body.light-theme .modal-header button.close svg,
body.light-theme .modal-header button.close path {
  color: #000000 !important;
  fill: #000000 !important;
  stroke: #000000 !important;
}
</style>


<style>
/* X do modal no tema claro - ajuste definitivo */
body.light-theme .modal-header .close,
body.light-theme .modal-header .btn-close,
body.light-theme .modal-header [aria-label="Close"],
body.light-theme .modal-header svg,
body.light-theme .modal-header path,
body.light-theme .modal-header use {
  color: #000000 !important;
  fill: #000000 !important;
  stroke: #000000 !important;
  opacity: 1 !important;
}
</style>


<style>
/* Garantir que QUALQUER X de modal no tema claro apare√ßa preto */
body.light-theme .close,
body.light-theme .btn-close,
body.light-theme [aria-label="Close"],
body.light-theme button[aria-label="Close"],
body.light-theme svg,
body.light-theme svg path,
body.light-theme svg use {
  color: #000000 !important;
  fill: #000000 !important;
  stroke: #000000 !important;
  opacity: 1 !important;
}
</style>


<style>
/* For√ßar X preto nos modais de Detalhes e Adicionar no tema claro */
body.light-theme .modal.modal-detalhes .close,
body.light-theme .modal.modal-detalhes .btn-close,
body.light-theme .modal.modal-detalhes [aria-label="Close"],
body.light-theme .modal.modal-detalhes svg,
body.light-theme .modal.modal-detalhes svg path,
body.light-theme .modal.modal-detalhes svg use,
body.light-theme .modal.modal-adicionar .close,
body.light-theme .modal.modal-adicionar .btn-close,
body.light-theme .modal.modal-adicionar [aria-label="Close"],
body.light-theme .modal.modal-adicionar svg,
body.light-theme .modal.modal-adicionar svg path,
body.light-theme .modal.modal-adicionar svg use {
  color: #000000 !important;
  fill: #000000 !important;
  stroke: #000000 !important;
  opacity: 1 !important;
  filter: none !important;
}
</style>

</head>
<body>

<button id="installPWA" style="position:fixed;bottom:20px;right:20px;z-index:2000;background:#4CAF50;color:#fff;border:none;padding:10px 16px;border-radius:30px;box-shadow:0 4px 6px rgba(0,0,0,0.3);cursor:pointer;display:none;">üì≤ Instalar App</button>


<div id="menuBtn" style="position:fixed;bottom:20px;left:20px;z-index:2000;cursor:pointer;font-size:26px;background:#4CAF50;color:#fff;width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 6px rgba(0,0,0,0.3);">‚ò∞</div>
<div id="menuDropdown" style="display:none;position:fixed;bottom:80px;left:20px;z-index:2000;background:#fff;color:#000;border:1px solid #ccc;border-radius:5px;box-shadow:0 4px 6px rgba(0,0,0,0.2);min-width:150px;">
  <div id="setDarkTheme" style="padding:10px 20px;cursor:pointer;border-bottom:1px solid #ddd;">üåô Tema Escuro</div>
  <div id="setLightTheme" style="padding:10px 20px;cursor:pointer;">‚òÄÔ∏è Tema Claro</div>
</div>

<header>
  <h1>
    Minhas Despesas
    <div class="header-buttons">
      <button class="icon-btn" id="btnShare" title="Compartilhar pelo WhatsApp">üì§</button>
      <select id="filterSelect" class="filter-select" title="Filtro de despesas">
        <option value="default">Filtro</option>
        <option value="a-z">A ‚Üí Z</option>
        <option value="z-a">Z ‚Üí A</option>
        <option value="pago">Pago</option>
        <option value="npago">N√£o Pago</option>
      </select>
    </div>
  </h1>
  <div class="totals">
    <div class="metric"><small>‚óå Total</small><strong id="totMes">R$ 0,00</strong></div>
    <div class="metric"><small>‚ö†Ô∏è A pagar</small><strong id="aPagar">R$ 0,00</strong></div>
  </div>
  <div class="month">
    <button class="icon-btn" id="prevMonth" aria-label="M√™s anterior">‚üµ</button>
    <div class="pill" id="monthLabel">Agosto/2025</div>
    <button class="icon-btn" id="nextMonth" aria-label="Pr√≥ximo m√™s">‚ü∂</button>
  </div>
</header>

<main>
  <ul class="list" id="list"></ul>
</main>

<footer class="totbar"></footer>

<button class="fab" id="fab" title="Adicionar">+</button>

<!-- Modal de cadastro/edi√ß√£o -->
<div class="modal" id="modalForm" aria-modal="true" role="dialog">
  <div class="sheet">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:6px">
      <h2 id="formTitle" style="margin:0;flex:1">Adicionar despesa</h2>
      <button class="icon-btn" id="closeForm" aria-label="Fechar">‚úï</button>
    </div>

    <div class="row">
      <div>
        <label for="descricao">Descri√ß√£o</label>
        <input id="descricao" placeholder="Ex.: Aluguel" />
      </div>
      <div>
        <label for="valor">Valor (R$)</label>
        <input id="valor" type="number" step="0.01" min="0" placeholder="0,00" />
      </div>
    </div>
    <div class="row">
      <div>
        <label for="data">Data</label>
        <input id="data" type="date" />
      </div>
      <div>
        <label for="categoria">Categoria</label>
        <select id="categoria">
          <option value="bills">Cart√£o</option>
          <option value="edu">Educa√ß√£o</option>
          <option value="food">Alimenta√ß√£o</option>
          <option value="trans">Transporte</option>
          <option value="home">Moradia</option>
          <option value="health">Sa√∫de</option>
          <option value="ent">Lazer</option>
          <option value="clothes">Roupas</option>
          <option value="others">Outros</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div>
        <label for="repeticao">Repeti√ß√£o</label>
        <select id="repeticao">
          <option value="unica">√önica</option>
          
          <option value="parcelado">Parcelado</option>
        </select>
      </div>
      <div id="parcelasWrap" style="display:none">
        <label for="parcelas">Qtd. parcelas</label>
        <input id="parcelas" type="number" min="1" max="96" step="1" value="2" />
      </div>
    </div>
    <div class="actions">
      <button class="btn ghost" id="cancelForm">Cancelar</button>
      <button class="btn primary" id="save">Salvar</button>
    </div>
  </div>
</div>

<!-- Modal de detalhes -->
<div class="modal" id="modalDetail" aria-modal="true" role="dialog">
  <div class="sheet detail">
    <div style="display:flex;align-items:center;gap:12px">
      <h2 id="detTitulo" style="margin:0;flex:1">‚Äì</h2>
      <div class="toolbar">
        <button class="icon-btn" id="editBtn" title="Editar" aria-label="Editar">‚úé</button>
        <button class="icon-btn" id="delBtn" title="Excluir" aria-label="Excluir">üóë</button>
        <button class="icon-btn" id="closeDetail" title="Fechar" aria-label="Fechar">‚úï</button>
      </div>
    </div>

    <div class="line"><span class="tag c-bills">üí≤</span> <div><div class="muted">Valor</div><div id="detValor" class="title">‚Äì</div></div></div>
    <div class="line"><span class="tag c-edu">üìÖ</span> <div><div class="muted">Data</div><div id="detData" class="title">‚Äì</div></div></div>
    <div class="line"><span class="tag c-others">üí≥</span> <div><div class="muted">Categoria</div><div id="detCat" class="title">‚Äì</div></div></div>
    <div class="line"><span class="tag" id="paidTag">‚úÖ</span> <div><div class="title" id="detPagoTitulo">‚Äì</div><div class="muted" id="detPagoInfo"></div></div></div>

    <div class="actions">
      <button class="btn primary" id="togglePago">Marcar como pago</button>
    </div>
  </div>
</div>

<script>
(function(){
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const meses = ['janeiro','fevereiro','mar√ßo','abril','maio','junho','julho','agosto','setembro','outubro','novembro','dezembro'];
  const fmtMoney = v => (v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  const iso = d => new Date(d).toISOString().slice(0,10);
  const byId = id => expenses.find(x=>x.id===id);
  const uid = () => Math.random().toString(36).slice(2,9)+Date.now().toString(36).slice(-4);

  let now = new Date();
  let viewMonth = now.getMonth();
  let viewYear = now.getFullYear();

  const KEY = 'md_expenses_v3';
  let expenses = JSON.parse(localStorage.getItem(KEY))||[];

  const catMap = {
    bills:{name:'Cart√£o', cls:'c-bills', icon:'üí≥'},
    edu:{name:'Educa√ß√£o', cls:'c-edu', icon:'üéì'},
    food:{name:'Alimenta√ß√£o', cls:'c-food', icon:'üçî'},
    trans:{name:'Transporte', cls:'c-trans', icon:'üöå'},
    home:{name:'Moradia', cls:'c-home', icon:'üè†'},
    health:{name:'Sa√∫de', cls:'c-health', icon:'üíä'},
    ent:{name:'Lazer', cls:'c-ent', icon:'üéÆ'},
    clothes:{name:'Roupas', cls:'c-clothes', icon:'üëï'},
    others:{name:'Outros', cls:'c-others', icon:'‚Ä¶'}
  };

  let currentFilter = 'default';

  function save(){ localStorage.setItem(KEY, JSON.stringify(expenses)); }

  function setMonthLabel(){ $('#monthLabel').textContent = `${meses[viewMonth].charAt(0).toUpperCase()+meses[viewMonth].slice(1)}/${viewYear}` }

  function render(){
    setMonthLabel();
    const monthISO = d => { const dt=new Date(d); return dt.getMonth()===viewMonth && dt.getFullYear()===viewYear }

    let items = expenses.filter(e=> monthISO(e.date));

    // Aplicar filtro
    if(currentFilter==='a-z') items.sort((a,b)=> a.title.localeCompare(b.title));
    else if(currentFilter==='z-a') items.sort((a,b)=> b.title.localeCompare(a.title));
    else if(currentFilter==='pago') items = items.filter(e=>e.paid);
    else if(currentFilter==='npago') items = items.filter(e=>!e.paid);
    else items.sort((a,b)=> new Date(a.date)-new Date(b.date));

    const ul = $('#list'); ul.innerHTML='';
    let total=0, toPay=0, paidTotal=0;

    items.forEach(e=>{
      total += Number(e.value);
      if(!e.paid) toPay += Number(e.value);
      if(e.paid) paidTotal += Number(e.value);

      const li = document.createElement('li');
      li.className='item';
      li.dataset.id = e.id;
      const cat = catMap[e.category] || catMap.others;

      li.innerHTML = `
        <div class="left">
          <div class="avatar ${cat.cls}">${cat.icon}</div>
          <div>
            <div class="title">${e.title} ${e.totalParc?`${e.parc}/${e.totalParc}`:''}</div>
            <div class="sub">${cat.name}</div>
          </div>
        </div>
        <div class="right">
          <div class="value">${fmtMoney(Number(e.value))}<span class="status-dot" style="background:${e.paid?'var(--success)':'var(--danger)'}"></span></div>
          <div class="date">${new Date(e.date).toLocaleDateString('pt-BR')}</div>
        </div>`;
      li.addEventListener('click', ()=> openDetail(e.id));
      ul.appendChild(li);
    });

    $('#totMes').textContent = fmtMoney(total);
    $('#aPagar').textContent = fmtMoney(toPay);
  }

  $('#prevMonth').addEventListener('click', ()=> { viewMonth--; if(viewMonth<0){viewMonth=11;viewYear--;}; render(); });
  $('#nextMonth').addEventListener('click', ()=> { viewMonth++; if(viewMonth>11){viewMonth=0;viewYear++;}; render(); });
  $('#fab').addEventListener('click', ()=> form.open());

  $('#filterSelect').addEventListener('change', function(){
    currentFilter = this.value;
    render();
  });

  const form = {
    open(editId){
      $('#modalForm').classList.add('show');
      if(editId){
        const e = byId(editId);
        $('#formTitle').textContent='Editar despesa';
        $('#descricao').value=e.title;
        $('#valor').value=e.value;
        $('#data').value=iso(e.date);
        $('#categoria').value=e.category;
        $('#repeticao').value=e.totalParc?'parcelado':(e.repeticao||'unica');
        $('#parcelasWrap').style.display=e.totalParc?'block':'none';
        $('#parcelas').value=e.totalParc||2;
        $('#save').dataset.editId=editId;
      }else{
        $('#formTitle').textContent='Adicionar despesa';
        $('#descricao').value='';
        $('#valor').value='';
        $('#data').value=iso(now);
        $('#categoria').value='bills';
        $('#repeticao').value='unica';
        $('#parcelasWrap').style.display='none';
        delete $('#save').dataset.editId;
      }
    },
    close(){ $('#modalForm').classList.remove('show'); }
  }

  $('#repeticao').addEventListener('change', e=> $('#parcelasWrap').style.display = e.target.value==='parcelado'?'block':'none');
  $('#cancelForm').addEventListener('click', ()=> form.close());
  $('#closeForm').addEventListener('click', ()=> form.close());

  $('#save').addEventListener('click', ()=>{
    const title = $('#descricao').value.trim();
    const value = parseFloat($('#valor').value)||0;
    const date = $('#data').value;
    const category = $('#categoria').value;
    const repeticao = $('#repeticao').value;
    const parcelas = parseInt($('#parcelas').value)||1;

    if(!title || !date || !value) return alert('Preencha todos os campos');

    const editId = $('#save').dataset.editId;
    if(editId){
      const e = byId(editId);
      e.title = title; e.value=value;e.date=date;e.category=category;
      e.repeticao=repeticao;e.totalParc=repeticao==='parcelado'?parcelas:null;e.parc=1;
    }else{
      if(repeticao==='parcelado'){
        for(let i=0;i<parcelas;i++){
          const dt = new Date(date);
          dt.setMonth(dt.getMonth()+i);
          expenses.push({id:uid(), title,value,date:iso(dt),category,repeticao,parc:i+1,totalParc:parcelas,paid:false});
        }
      }else{
        expenses.push({id:uid(),title,value,date,category,repeticao,paid:false});
      }
    }

    save(); render(); form.close();
  });

  // Detalhes
  const detail = {
    current:null,
    open(id){
      const e = byId(id); detail.current=e;
      $('#detTitulo').textContent=e.title;
      $('#detValor').textContent=fmtMoney(e.value);
      $('#detData').textContent=new Date(e.date).toLocaleDateString('pt-BR');
      const cat = catMap[e.category]||catMap.others;
      $('#detCat').textContent=cat.name;
      $('#detPagoTitulo').textContent=e.paid?'Pago':'N√£o pago';
      $('#detPagoInfo').textContent=e.paid?'Esta despesa j√° foi quitada':'Esta despesa ainda n√£o foi paga';
      $('#togglePago').textContent=e.paid?'Desmarcar como pago':'Marcar como pago';
      $('#modalDetail').classList.add('show');
    },
    close(){ $('#modalDetail').classList.remove('show'); detail.current=null; }
  }
  function openDetail(id){ detail.open(id); }
  $('#closeDetail').addEventListener('click',()=> detail.close());
  $('#togglePago').addEventListener('click', ()=>{
    if(!detail.current) return;
    detail.current.paid = !detail.current.paid;
    save(); render(); detail.open(detail.current.id);
  });

  $('#editBtn').addEventListener('click', ()=>{
    if(!detail.current) return;
    form.open(detail.current.id);
    detail.close();
  });
  $('#delBtn').addEventListener('click', ()=>{
    if(!detail.current) return;
    if(confirm('Deseja realmente excluir esta despesa?')){
      expenses = expenses.filter(e=>e.id!==detail.current.id);
      save(); render(); detail.close();
    }
  });

  // Compartilhar via WhatsApp
  $('#btnShare').addEventListener('click', ()=>{
    const monthISO = d => { const dt=new Date(d); return dt.getMonth()===viewMonth && dt.getFullYear()===viewYear }
    let items = expenses.filter(e=> monthISO(e.date));

    if(currentFilter==='a-z') items.sort((a,b)=> a.title.localeCompare(b.title));
    else if(currentFilter==='z-a') items.sort((a,b)=> b.title.localeCompare(a.title));
    else if(currentFilter==='pago') items = items.filter(e=>e.paid);
    else if(currentFilter==='npago') items = items.filter(e=>!e.paid);
    else items.sort((a,b)=> new Date(a.date)-new Date(b.date));

    let total=0, toPay=0, paidTotal=0;
    let text = `üí∞ Minhas Despesas (${meses[viewMonth].charAt(0).toUpperCase()+meses[viewMonth].slice(1)}/${viewYear})\n\n`;
    items.forEach(e=>{
      total+=Number(e.value);
      if(e.paid) paidTotal+=Number(e.value); else toPay+=Number(e.value);
      text+=`- ${e.title} - ${fmtMoney(Number(e.value))} - ${e.paid?'Pago':'N√£o pago'}\n`;
    });
    text += `\nTotal: ${fmtMoney(total)}\nPago: ${fmtMoney(paidTotal)}\nA pagar: ${fmtMoney(toPay)}`;
    const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
    window.open(url,'_blank');
  });

  render();
})();
</script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(() => console.log('Service Worker registrado!'));
}
</script>

<script>
// ================== TEMA ==================
if (localStorage.getItem('theme') === 'light') {
  document.body.classList.add('light-theme');
}
const menuBtn = document.getElementById('menuBtn');
const menuDropdown = document.getElementById('menuDropdown');
menuBtn.addEventListener('click', () => {
  menuDropdown.style.display = menuDropdown.style.display === 'block' ? 'none' : 'block';
});
document.getElementById('setDarkTheme').addEventListener('click', () => {
  document.body.classList.remove('light-theme');
  localStorage.setItem('theme', 'dark');
  menuDropdown.style.display = 'none';
});
document.getElementById('setLightTheme').addEventListener('click', () => {
  document.body.classList.add('light-theme');
  localStorage.setItem('theme', 'light');
  menuDropdown.style.display = 'none';
});

// ================== PWA INSTALL ==================
let deferredPrompt;
const installBtn = document.getElementById('installPWA');
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'block';
});
installBtn.addEventListener('click', async () => {
  installBtn.style.display = 'none';
  deferredPrompt.prompt();
  const choiceResult = await deferredPrompt.userChoice;
  deferredPrompt = null;
});
</script>

</body>
</html>
